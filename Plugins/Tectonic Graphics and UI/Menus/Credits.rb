CHASM_CREDITs = <<_END_

Major Contributors
Brickbat<s>Zeu
Divock<s>Agentbla
Wakarimasensei<s>Drawingbox
IgnitedxSoul<s>LucaSantosSims
Darlvon<s>Jaggedthorn
Splitmoon<s>TikiShades
Valrex<s>Steeb
Tirankin<s>Ci
Yufeng


Other Contributors
Arenastellez<s>Zufaix
Fbarbarosa<s>ctWizard
Slaynoir<s>Maddie
FurretKnight<s>Dtp81390
Gabs<s>derrondad
BlueObelisk<s>SimplyDark
MrPanda1<s>Angelcake
Mikomii<s>Jbsundown
Valrex<s>Avery
Destinygreatness<s>Gary Oak
ali760<s>papper
lichenprincess<s>Enigma
princessroxie<s>Joaquín Arellano
M1ntyFr3shD4n<s>pechapanda
zombygoast<s>Riptidecord
LunaFlare

{INSERTS_PLUGIN_CREDITS_DO_NOT_REMOVE}

Multiple Save Plugin
bo4p5687<s>mej71

Tilesheets
Kyle Dove (Kymotonian)<s>Speedialga
Sagaxxy<s>Magiscarf
KingTapir<s>PkmnAlexandrite
Phyromatical<s>EVoLiNa
Midnitez-REMIX<s>ditto209
UltimoSpriter<s>PeekyChew
Cuddlesthefatcat<s>Pablus94
Hydrargirium<s>zetavares852
TyranitarDark<s>ChaoticCherryCake
AveonTrainer<s>kane89
carchagui<s>Princess-Phoenix
DormDude<s>Rayquaza-dot
Vazquinho<s>Yveltalchannel
Magna-Ryunoid<s>Plutomaniacx
LilaTraube<s>seiyouh
SpritersResource<s>Thatsowitty
exiled-shadow<s>ausberge
supercow<s>LunaMaddalena
Alucus<s>The English Kiwi
calisprojects.com<s>PandaInDaGame
Hek-el-grande<s>Kaliser
SailorVicious<s>Agentbla
Shiney570<s>dirtywiggles
Ekat<s>MewTheMega
Zeo254<s>Tristantine The Great
HauntedArtStudio<s>Wraitex
YuukiMokuya<s>CNickC
WilsonScarloxy<s>Minorthreat0987
PurpleZaffre<s>Akizakura16
WildDeadHero<s>Derlo
Flurmimon<s>The-Red-Ex
The_Jacko_Art<s>Voltseon
WesleyFG<s>Shawn Frost
NSora-96<s>Minorthreat0987
DarkDragonn<s>rafa-cac
Newtiteuf<s>moca
Jaggedthorn<s>Raindropsonwhiskers

Charsets
DiegoWT<s>PurpleZaffre
Taiga

Trainer Sprites
Mr. Gela<s>theo

Taiga's Trainer Collection (X/Y)
Taiga<s>DiegoWT
Neo-Spriteman<s>Vanilla Sunshine
AtomicReactor<s>izzyvivious
Mademoiselle<s>PizzaSun
izzyvicious<s>Wolfgang62
Somersault

Megas/Gigantamax Overworld Sprites
Kidkatt<s>Larryturbo
Princess-Phoenix<s>Sagedeoxys

Other Overworld Sprites
Larryturbo<s>Kyle Dove
Azria<s>Twitch

Reborn Icons
smeargletail<s>ARandomTalkingBush

Reborn Move Animations
Smeargletail<s>Mde2001
Autumn<s>VulpesDraconis
Amethyst<s>Crim
andracass<s>Koyoss
Jan<s>

Pre-looped Music Pack
ENLS

Generation 8 Project

Battler Sprites
Gen 1-5 Pokemon Sprites
veekun
Gen 6 Pokemon Sprites
Smogon X/Y Sprite Project
Gen 7 Pokemon Sprites
Smogon Sun/Moon Sprite Project
Gen 8 Pokemon Sprites
Smogon Sword/Shield Sprite Project

Overworld Sprites
princess-pheonix<s>LunarDusk
Wolfang62<s>TintjeMadelintje101
piphybuilder88<s>Larry Turbo
SageDeoxys
Gen 1-5 Pokemon Overworlds
MissingLukey<s>help-14
Kymoyonian<s>cSc-A7X
2and2makes5<s>Pokegirl4ever
Fernandojl<s>Silver-Skies
TyranitarDark<s>Getsuei-H
Kid1513<s>Milomilotic11
Kyt666<s>kdiamo11
Chocosrawlooid<s>Syledude
Gallanty<s>Gizamimi-Pichu
2and2makes5<s>Zyon17
LarryTurbo<s>spritesstealer
Icon Sprites
Alaguesia<s>Marin
MapleBranchWing<s>Repository
Larry Turbo<s>Leparagon
Cry Credits
Rhyden<s>Marin
Rhyden<s>Zeak6464
PBS Credits
Golisopod User<s>Zerokid
TheToxic<s>HM100
KyureJL<s>ErwanBeurier
Gen 8 Scripts
Golisopod User<s>Maruno
Vendily<s>TheToxic
HM100<s>Aioross
WolfPP<s>MFilice
lolface<s>KyureJL
DarrylBD99<s>Turn20Negate
TheKandinavian<s>ErwanBeurier
Compilation of Resources
Golisopod User<s>UberDunsparce
Porting to v19
Golisopod User<s>Maruno

Generation 9 Pack
Script Gen 9 and Adapting PLA for v20:
Caruban<s>Lucidious89
Eskiss
PBS for Gen 9:
Caruban<s>PorousMist
DJChaos<s>Futuresushi
Pokemon Gen 9 Battler Sprites:
KingOfThe-X-Roads<s>Mak
Caruban<s>jinxed
leParagon<s>Sopita_Yorita
Azria<s>Mashirosakura,
JordanosArt<s>Abnayami
OldSoulja<s>Katten
Divaruta 666<s>Clara
Skyflyer<s>AshnixsLaw
Pokemon Gen 9 icons:
ezerart, JordanosArt
Pokemon Gen 9 Followers:
Azria<s>DarkusShadow
EduarPokeN<s>Carmanekko
StarWolff<s>Caruban
PLA and Gen 9 Footprints
Caruban
Pokemon Gen 9 Cries:
Lightblade Absol<s>HeroLinik
Gen 9 item icons:
lichenprincess<s>Caruban
PLA item icons:
AztecCroc<s>3DJackArt
Caruban<s>lichenprincess
Pokemon cries ripped:
Morningdew
PLA Icons:
LuigiTKO
PLA Followers:
Boonzeet<s>DarkusShadow
princess-phoenix<s>Ezeart
WolfPP
PLA Sprites from Smogon Gen8 Sprite Project
Blaquaza<s>KingOfThe-X-Roads
KattenK<s>Travis
G.E.Z.<s>SpheX
Hematite<s>SelenaArmorclaw

Castform Sandy
Jumpy<s>Noel
The FnF Showdown community

Spanish PokeDex Translations
Everson

"Pokémon Essentials" was created by:
Flameguru
Poccil (Peter O.)
Maruno

With contributions from:
AvatarMonkeyKirby<s>Marin
Boushy<s>MiDas Mike
Brother1440<s>Near Fantastica
FL.<s>PinkMan
Genzai Kawakami<s>Popper
Golisopod User<s>Rataime
help-14<s>Savordez
IceGod64<s>SoundSpawn
Jacob O. Wobbrock<s>the__end
KitsuneKouta<s>Venom12
Lisa Anthony<s>Wachunga
Luka S.J.<s>
and everyone else who helped out

"mkxp-z" by:
Roza
Based on MKXP by Ancurio et al.

"RPG Maker XP" by:
Enterbrain

Misc. thanks to:
DemIce

Pokémon is owned by:
The Pokémon Company
Nintendo
Affiliated with Game Freak

This is a non-profit fan-made game.
No copyright infringements intended.
Please support the official games!

_END_

class Scene_Credits
	  # Backgrounds to show in credits. Found in Graphics/Titles/ folder
	  BACKGROUNDS_LIST       = ["credits1", "credits2", "credits3", "credits4", "credits5"]
	  BGM                    = "Credits"
	  SCROLL_SPEED           = 40   # Pixels per second
	  SECONDS_PER_BACKGROUND = 11
	  TEXT_OUTLINE_COLOR     = Color.new(0, 0, 128, 255)
	  TEXT_BASE_COLOR        = Color.new(255, 255, 255, 255)
	  TEXT_SHADOW_COLOR      = Color.new(0, 0, 0, 100)

	def initialize(callback = nil)
		@callback = callback
	end

	def main
		#-------------------------------
		# Animated Background Setup
		#-------------------------------
		@counter = 0.0   # Counts time elapsed since the background image changed
		@bg_index = 0
		@bitmap_height = Graphics.height   # For a single credits text bitmap
		@trim = Graphics.height / 10
		# Number of game frames per background frame
		@realOY = -(Graphics.height - @trim)
		#-------------------------------
		# Credits text Setup
		#-------------------------------
		plugin_credits = ""
		PluginManager.plugins.each do |plugin|
			pcred = PluginManager.credits(plugin)
			plugin_credits << "\"#{plugin}\" v.#{PluginManager.version(plugin)} by:\n"
			if pcred.size >= 5
				plugin_credits << pcred[0] + "\n"
				i = 1
				until i >= pcred.size
					plugin_credits << pcred[i] + "<s>" + (pcred[i + 1] || "") + "\n"
					i += 2
				end
			else
				pcred.each { |name| plugin_credits << name + "\n" }
			end
			plugin_credits << "\n"
		end
		CHASM_CREDITs.gsub!(/\{INSERTS_PLUGIN_CREDITS_DO_NOT_REMOVE\}/, plugin_credits)
		credit_lines = CHASM_CREDITs.split(/\n/)
		#-------------------------------
		# Make background and text sprites
		#-------------------------------
		text_viewport = Viewport.new(0, @trim, Graphics.width, Graphics.height - (@trim * 2))
		text_viewport.z = 99999
		@background_sprite = IconSprite.new(0, 0)
		@background_sprite.setBitmap("Graphics/Titles/" + BACKGROUNDS_LIST[0])
		@credit_sprites = []
		@total_height = credit_lines.size * 32
		lines_per_bitmap = @bitmap_height / 32
		num_bitmaps = (credit_lines.size.to_f / lines_per_bitmap).ceil
		for i in 0...num_bitmaps
			credit_bitmap = Bitmap.new(Graphics.width, @bitmap_height)
			pbSetSystemFont(credit_bitmap)
			for j in 0...lines_per_bitmap
				line = credit_lines[i * lines_per_bitmap + j]
			next if !line
			line = line.split("<s>")
			xpos = 0
			align = 1   # Centre align
			linewidth = Graphics.width
			for k in 0...line.length
				if line.length > 1
					xpos = (k == 0) ? 0 : 20 + Graphics.width / 2
					align = (k == 0) ? 2 : 0   # Right align : left align
					linewidth = Graphics.width / 2 - 20
				end
				credit_bitmap.font.color = TEXT_SHADOW_COLOR
				credit_bitmap.draw_text(xpos,     j * 32 + 8, linewidth, 32, line[k], align)
				credit_bitmap.font.color = TEXT_OUTLINE_COLOR
				credit_bitmap.draw_text(xpos + 2, j * 32 - 2, linewidth, 32, line[k], align)
				credit_bitmap.draw_text(xpos,     j * 32 - 2, linewidth, 32, line[k], align)
				credit_bitmap.draw_text(xpos - 2, j * 32 - 2, linewidth, 32, line[k], align)
				credit_bitmap.draw_text(xpos + 2, j * 32,     linewidth, 32, line[k], align)
				credit_bitmap.draw_text(xpos - 2, j * 32,     linewidth, 32, line[k], align)
				credit_bitmap.draw_text(xpos + 2, j * 32 + 2, linewidth, 32, line[k], align)
				credit_bitmap.draw_text(xpos,     j * 32 + 2, linewidth, 32, line[k], align)
				credit_bitmap.draw_text(xpos - 2, j * 32 + 2, linewidth, 32, line[k], align)
				credit_bitmap.font.color = TEXT_BASE_COLOR
				credit_bitmap.draw_text(xpos,     j * 32,     linewidth, 32, line[k], align)
				end
			end
			credit_sprite = Sprite.new(text_viewport)
			credit_sprite.bitmap = credit_bitmap
			credit_sprite.z      = 9998
			credit_sprite.oy     = @realOY - @bitmap_height * i
			@credit_sprites[i] = credit_sprite
		end
		#-------------------------------
		# Setup
		#-------------------------------
		# Stops all audio but background music
		previousBGM = $game_system.getPlayingBGM
		pbMEStop
		pbBGSStop
		pbSEStop
		pbBGMFade(2.0)
		pbBGMPlay(BGM)
		Graphics.transition(20)
		loop do
			Graphics.update
			Input.update
			update
			break if $scene != self
		end
		pbBGMFade(2.0)
		Graphics.freeze
		Graphics.transition(20, "fadetoblack")
		@background_sprite.dispose
		@credit_sprites.each { |s| s.dispose if s }
		text_viewport.dispose
		$PokemonGlobal.creditsPlayed = true
		pbBGMPlay(previousBGM)
	end

	# Check if the credits should be cancelled
	def cancel?
		if Input.trigger?(Input::SPECIAL)
			pbBGMFade(2.0)
			@callback.call if @callback
			return true
		end
		return false
	end

	# Checks if credits bitmap has reached its ending point
	def last?
		if @realOY > @total_height + @trim
			pbBGMFade(2.0)
			@callback.call if @callback
			return true
		end
		return false
	end

	def update
		delta = Graphics.delta_s
		@counter += delta
		# Go to next slide
		if @counter >= SECONDS_PER_BACKGROUND
		  @counter -= SECONDS_PER_BACKGROUND
		  @bg_index += 1
		  @bg_index = 0 if @bg_index >= BACKGROUNDS_LIST.length
		  @background_sprite.setBitmap("Graphics/Titles/" + BACKGROUNDS_LIST[@bg_index])
		end
		return if cancel?
		return if last?
		scrollingSpeed = SCROLL_SPEED
		scrollingSpeed *= 4 if Input.press?(Input::ACTION)
		scrollingSpeed *= 4 if Input.press?(Input::USE)
		@realOY += scrollingSpeed * delta
		@credit_sprites.each_with_index { |s, i| s.oy = @realOY - @bitmap_height * i }
	end
end